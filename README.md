# TypeScript å°ç¨‹åº & TypeScript äº‘å‡½æ•°å¼€å‘æ¨¡æ¿

å¾®ä¿¡å°ç¨‹åºå¼€å‘ï¼Œå·²ç»ç›´æ¥æ”¯æŒ `TypeScript`ï¼Œä½†æ–°å‡ºçš„ã€Œäº‘å‡½æ•°ã€ä»ç„¶ä¸æ”¯æŒ `TypeScript`ï¼Œè¿™ä»¤çƒ­çˆ± `TypeScript` çš„æˆ‘ï¼Œé¢‡æ„Ÿä¸æ–¹ä¾¿ã€‚

`TypeScript` å¼ºå¤§çš„ç±»å‹èƒ½åŠ›ä»¤äººæ²‰é†‰ï¼Œæˆ‘æƒ³è¦çš„æ•ˆæœæ˜¯ï¼š

- æ ¹æ®äº‘å‡½æ•°ä»£ç ï¼Œè‡ªåŠ¨ç”Ÿæˆå¼ºç±»å‹çš„å®¢æˆ·ç«¯è°ƒç”¨ä»£ç ã€‚
- ä¸€ä¸ªå·¥ç¨‹ï¼Œä¸€ä¸ª `package.json`ï¼Œé€šè¿‡ç¼–è¯‘è‡ªåŠ¨ç”Ÿæˆå¤šä¸ªç‹¬ç«‹çš„äº‘å‡½æ•°ã€‚

æˆ‘ä»¬å…ˆå¤§è‡´è¯´ä¸€ä¸‹æœ€ç»ˆå®ç°å‡ºæ¥çš„æ•ˆæœï¼Œåé¢å†è¯´å¦‚ä½•å®ç°ã€‚

## åˆå§‹åŒ–

å»ºè®®ä½ ä» fork æˆ‘çš„ä»£ç å¼€å§‹ï¼Œè¯¥å·¥ç¨‹çš„æºåœ¨ï¼š

https://github.com/lip8up/typed-wx-miniprogram-with-cloud

é•œåƒåœ¨ï¼š

https://gitee.com/lip8up/typed-wx-miniprogram-with-cloud

## ç›®å½•ç»“æ„

å…ˆè¯´è¯´æºç çš„ç›®å½•ç»“æ„ï¼š

<img src="assets/01-layout.png" alt="æºç ç›®å½•ç»“æ„" width="50%">

`functions` é‡Œçš„ä»£ç ï¼Œç¼–è¯‘åï¼Œå°†å½¢æˆä»¥ä¸‹ç›®å½•ç»“æ„ï¼š

<img src="assets/02-build.png" alt="ç¼–è¯‘åçš„å‡½æ•°ç›®å½•ç»“æ„" width="50%">

> å½“ç„¶ï¼Œå¦‚æœä½ çš„å‡½æ•°æ¯”è¾ƒå¤æ‚ï¼Œéœ€è¦å¤šä¸ªæ–‡ä»¶ï¼Œå¯ä»¥åœ¨ `functions` ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªå­ç›®å½•ï¼Œè¯¥å­ç›®å½•çš„åå­—ï¼Œå°±æ˜¯ä½ çš„äº‘å‡½æ•°åå­—ï¼Œå­ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª `index.ts` ä½œä¸ºå…¥å£å‡½æ•°ï¼Œå…¶ä»–æ–‡ä»¶éƒ½æ”¾åœ¨è¯¥ç›®å½•ä¸‹ã€‚

ä¹Ÿå¯ä»¥å°†ä¸€äº›å·¥å…·ç±»çš„å‡½æ•°ï¼Œæ”¾åœ¨å…¶ä»–ç›®å½•ï¼Œç„¶ååœ¨ä¸»å‡½æ•°ä¸­å¼•ç”¨ï¼Œç¼–è¯‘å·¥å…·ï¼Œä¼šå¤„ç†å¼•ç”¨å…³ç³»ï¼Œç¡®ä¿æ¯ä¸ªå‡½æ•°éƒ½å¯ç‹¬ç«‹è¿è¡Œã€‚

å½“ç„¶ï¼Œä¸Šè¿°ç›®å½•ç»“æ„ï¼Œæ˜¯é€šè¿‡æ ¹ç›®å½•ä¸‹çš„ `project.config.json` è¿›è¡Œé…ç½®çš„ï¼Œä½ å¯ä»¥æ ¹æ®éœ€è¦è¿›è¡Œä¿®æ”¹ï¼š

```json
{
  "miniprogramRoot": "miniprogram/",
  "cloudfunctionRoot": "cloud/build/",
  "cloudfunctionTemplateRoot": "cloud/.template",
}
```

## åŒ…ä¾èµ–

æœ€ç»ˆä¸Šä¼ çš„æ˜¯ `build` ç›®å½•ä¸‹çš„å‡½æ•°ï¼Œæ¯ä¸ªå‡½æ•°ï¼Œå‡å«æœ‰å„è‡ªçš„ `package.json`ï¼Œå¹¶ä¸”å…¶ `dependencies` å­—æ®µä»…ä»…åŒ…å«æ¯ä¸ªå‡½æ•°å®é™…éœ€è¦çš„ï¼Œä¸ä¼šå¤šåŒ…å«ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œæœ¬ç¤ºä¾‹é¡¹ç›®ï¼Œè¢«å„ä¸ªå‡½æ•°å…±äº«ä½¿ç”¨çš„ `cloud/package.json` ä¸­ï¼Œ`dependencies` å­—æ®µçš„å€¼ä¸ºï¼š

```json
"dependencies": {
  "cheerio": "^1.0.0-rc.10",
  "got": "^11.8.2",
  "iconv-lite": "^0.6.3",
  "wx-server-sdk": "^2.5.3"
}
```

`context`ã€`format`ã€`sum` ç­‰å‡½æ•°æ¯”è¾ƒç®€å•ï¼Œåªä¾èµ– `wx-server-sdk` åŒ…ï¼Œä»¥ `sum` ä¸ºä¾‹ï¼Œå…¶ `package.json` ï¼ˆ`cloud/build/sum/package.json`ï¼‰ä¸ºï¼š

```json
{
  "name": "sum",
  "version": "1.0.0",
  "description": "",
  "author": "lip8up <lip8up@qq.com>",
  "license": "MIT",
  "dependencies": {
    "wx-server-sdk": "^2.5.3"
  }
}
```

è€Œ `transfer` ä¾èµ– `cheerio`ã€`got`ã€`iconv-lite`ã€`wx-server-sdk` å››ä¸ªåŒ…ï¼Œå…¶ `package.json`ï¼ˆ`cloud/build/transfer/package.json`ï¼‰ä¸ºï¼š

```json
{
  "name": "transfer",
  "version": "1.0.0",
  "description": "",
  "author": "lip8up <lip8up@qq.com>",
  "license": "MIT",
  "dependencies": {
    "got": "^11.8.2",
    "iconv-lite": "^0.6.3",
    "cheerio": "^1.0.0-rc.10",
    "wx-server-sdk": "^2.5.3"
  }
}
```

è¿™é‡Œæˆ‘ä»¬å…ˆç®€å•è¯´ä¸€ä¸‹ï¼Œåé¢å†è¯¦è¿°å¦‚ä½•å®ç°ã€‚

## äº‘å‡½æ•°ä»£ç 

æˆ‘ä»¬ä»¥ `sum` ä¸ºä¾‹ï¼Œå…¶å†…å®¹éå¸¸ç®€å•ï¼š

```ts
// cloud/src/functions/sum.ts
export default (a: number, b: number) => {
  return a + b
}
```

å¯ä»¥çœ‹åˆ°ï¼Œä½¿ç”¨äº† `export default`ï¼Œä½¿ç”¨çš„ä¹Ÿæ˜¯ `es module` æ ¼å¼ï¼Œè€Œäº‘å‡½æ•°ï¼Œè¦æ±‚å¯¼å‡º `main` å‡½æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨ `commonjs` çš„æ ¼å¼ã€‚

åˆ«ç€æ€¥ï¼Œæˆ‘å†™çš„ç¼–è¯‘å·¥å…·ï¼Œè¦æ±‚ä½ ç›´æ¥å†™ `export default`ï¼Œå‰©ä¸‹çš„ç¼–è¯‘å·¥å…·æ¥å¤„ç†ï¼Œå¦‚ä¸Šé¢çš„ä»£ç ï¼Œè¢«ç¼–è¯‘å·¥å…·å¤„ç†åï¼Œå½¢æˆå¦‚ä¸‹ä»£ç ï¼ˆ`cloud/build/sum/index.js`ï¼‰ï¼š

```js
'use strict';

//~~** This code was generated by rollup-plugin-wx-cloud, please DO NOT EDIT it. **~~

Object.defineProperty(exports, '__esModule', { value: true });

var cloud_1 = require('wx-server-sdk');

function _interopDefaultLegacy (e) { return e && typeof e === 'object' && 'default' in e ? e : { 'default': e }; }

var cloud_1__default = /*#__PURE__*/_interopDefaultLegacy(cloud_1);

const default_1 = (a, b) => {
    return a + b;
};
cloud_1__default["default"].init({ env: cloud_1__default["default"].DYNAMIC_CURRENT_ENV });
async function main(event) {
    return default_1(event.a, event.b);
}

exports.main = main;
//# sourceMappingURL=index.js.map
```

å¯ä»¥çœ‹åˆ° `export default` è¢«ç¼–è¯‘æ‰äº†ï¼Œå–è€Œä»£ä¹‹ï¼Œå¢åŠ äº†ä¸€ä¸ª `async function main` å‡½æ•°ï¼Œå¹¶ä¸”ä½¿ç”¨ `commonjs` çš„æ–¹å¼å¯¼å‡ºå®ƒ `exports.main = main;`ã€‚

ç¼–è¯‘å·¥å…·å‘ç°ä½ çš„åŸæœ‰ä»£ç ä¸­ï¼Œæ²¡æœ‰å¯¹ `wx-server-sdk` è¿›è¡Œåˆå§‹åŒ–ï¼Œä¼šæ›¿ä½ åˆå§‹åŒ–ï¼š

```js
var cloud_1 = require('wx-server-sdk');
var cloud_1__default = /*#__PURE__*/_interopDefaultLegacy(cloud_1);
`cloud_1__default["default"].init({ env: cloud_1__default["default"].DYNAMIC_CURRENT_ENV })`

// ä¸Šé¢æ˜¯ç¼–è¯‘åçš„ä»£ç ï¼Œå¯¹åº”çš„æºç ä¸ºï¼š
import cloud from 'wx-server-sdk'
cloud.init({ env: cloud.DYNAMIC_CURRENT_ENV })
```

> å¦‚æœä½ è¿›è¡Œäº†åˆå§‹åŒ–ï¼Œå®ƒå°±ä¸ä¼šå†åšå¤šä½™çš„åˆå§‹åŒ–æ“ä½œã€‚

## å®¢æˆ·ç«¯ä»£ç 

å†çœ‹ä¸€ä¸‹å¼ºç±»å‹çš„å®¢æˆ·ç«¯è°ƒç”¨ä»£ç æ–‡ä»¶ `miniprogram/lib/cloud.ts` çš„å†…å®¹ï¼ŒåŸè°…æˆ‘ç›´æ¥ä¸Šä¸€æ®µå¤§ä»£ç ï¼Œå¤§å®¶å…ˆç²—ç•¥çœ‹ä¸€ä¸‹ï¼Œçœ‹ä¸æ‡‚ä¹Ÿä¸è¦ç´§ï¼ˆèƒ½çœ‹æ‡‚ä¹Ÿä¸è¦å¯¹æˆ‘æ’‡å˜´ğŸ˜’ï¼‰ï¼Œæœ‰ä¸€ä¸ªå¤§æ¦‚çš„å°è±¡ï¼Œä¸‹é¢ä¼šä¸€æ­¥æ­¥å±•å¼€è®²è¿°ï¼š

```ts
//~~** This code was generated by rollup-plugin-wx-cloud, please DO NOT EDIT it. **~~
import type { main as functionContext } from '@cloud/functions/context'
import type functionFormat from '@cloud/functions/format'
import type functionSum from '@cloud/functions/sum'
import type functionTransfer from '@cloud/functions/transfer'

type PromiseType<T> = T extends Promise<infer _> ? T : Promise<T>

type PromiseReturnType<T extends (...args: any) => any> = (...args: Parameters<T>) => PromiseType<ReturnType<T>>

export const cloudContext = (data?: any): PromiseType<ReturnType<typeof functionContext>> => {
  return wx.cloud.callFunction({ name: 'context', data }).then(res => res.result as any)
}

export const cloudFormat: PromiseReturnType<typeof functionFormat> = json => {
  return wx.cloud.callFunction({ name: 'format', data: { json } }).then(res => res.result as any)
}

export const cloudSum: PromiseReturnType<typeof functionSum> = (a, b) => {
  return wx.cloud.callFunction({ name: 'sum', data: { a, b } }).then(res => res.result as any)
}

export const cloudTransfer: PromiseReturnType<typeof functionTransfer> = url => {
  return wx.cloud.callFunction({ name: 'transfer', data: { url } }).then(res => res.result as any)
}

export default {
  context: cloudContext,
  format: cloudFormat,
  sum: cloudSum,
  transfer: cloudTransfer
}
```

### åˆ«å

`@cloud` æ˜¯åœ¨é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„ `tsconfig.json` é…ç½®çš„åˆ«åï¼ŒæŒ‡å‘ `cloud/src/*`ï¼š

```json
{
  "compilerOptions": {
    // ...
    "baseUrl": ".",
    "paths": {
      "@cloud/*": [
        "cloud/src/*"
      ]
    }
  },
  "include": [
    "./**/*.ts"
  ],
  "exclude": [
    "node_modules"
  ]
}

```

> ç›®å‰ï¼Œå¾®ä¿¡å®˜æ–¹ä»ä¸æ”¯æŒä½¿ç”¨åˆ«åï¼ˆé™¤éä½¿ç”¨é¢„å¤„ç†æ„å»ºï¼‰ï¼Œå¥½åœ¨è¯¥åˆ«ååªç”¨ä½œ `import type`ï¼Œç¼–è¯‘åå¹¶ä¸ä¼šå‡ºç°åœ¨ç¼–è¯‘åçš„ç»“æœæ–‡ä»¶ä¸­ã€‚

### ä¸¾ä¾‹åˆ†æ

æˆ‘ä»¬ä»ä»¥ `sum` ä¸ºä¾‹ï¼Œå…¶ä»£ç å†çœ‹ä¸€éï¼š

```ts
// cloud/src/functions/sum.ts
export default (a: number, b: number) => {
  return a + b
}
```

ç”Ÿæˆçš„å®¢æˆ·ç«¯è®¿é—®ä»£ç ä¸ºï¼š

```ts
import type functionSum from '@cloud/functions/sum'

export const cloudSum: PromiseReturnType<typeof functionSum> = (a, b) => {
  return wx.cloud.callFunction({ name: 'sum', data: { a, b } }).then(res => res.result as any)
}
```

å¯ä»¥çœ‹åˆ°ï¼Œæ ¸å¿ƒæ˜¯ `PromiseReturnType`ï¼Œè§åçŸ¥æ„ï¼Œå®ƒå°†ä¸€ä¸ªå‡½æ•°ç±»å‹çš„è¿”å›å€¼ Promise åŒ–ã€‚

ä¸¾ä¾‹æ¥è¯´ï¼Œä¸Šé¢çš„ `sum` å‡½æ•°çš„ç±»å‹ï¼ˆå³ `typeof functionSum` çš„ç»“æœï¼‰ä¸ºï¼š

```ts
(a: number, b: number) => number
```

ç»è¿‡ `PromiseReturnType<typeof functionSum>` åï¼Œå˜ä¸ºï¼š

```ts
(a: number, b: number) => Promise<number>
```

ä¸ºä»€ä¹ˆè¦åšè¿™ç§å˜æ¢å‘¢ï¼Ÿ

å¾ˆæ˜¾ç„¶ï¼Œå®¢æˆ·ç«¯è°ƒç”¨äº‘å‡½æ•°ï¼Œè‚¯å®šéƒ½æ˜¯å¼‚æ­¥çš„å‘€ï¼Œæ‰€ä»¥è¦ç”¨å¼‚æ­¥å‡½æ•°ã€‚

> å¦‚æœå‡½æ•°æœ¬èº«çš„è¿”å›å€¼å°±æ˜¯ Promise<T> å‘¢ï¼ŒPromiseReturnType è€ƒè™‘åˆ°äº†è¿™ç§æƒ…å†µï¼Œä¸ä¼šå‡ºç° Promise<Promise<T>> è¿™æ ·çš„ç»“æœã€‚
>
> å…¶å®ï¼Œå³ä¾¿ä½¿ç”¨äº† Promise<Promise<T>>ï¼Œä¹Ÿä¸å½±å“æœ€ç»ˆçš„ä½¿ç”¨æ•ˆæœï¼Œè¿™æ˜¯ç”± Promise çš„ç‰¹æ€§å†³å®šçš„ã€‚

çŸ¥é“äº† `PromiseReturnType` çš„ä½œç”¨ï¼Œä¸‹é¢çš„å‡½æ•°ä½“ï¼Œå°±å¥½ç†è§£å¤šäº†ï¼š

```ts
export const cloudSum: PromiseReturnType<typeof functionSum> = (a, b) => {
  return wx.cloud.callFunction({ name: 'sum', data: { a, b } }).then(res => res.result as any)
}
```

ç”±äºå·²ç»ä¸º `cloudSum` æ ‡æ³¨äº†ç±»çš„å‹ `(a: number, b: number) => Promise<number>`ï¼Œå‚æ•° `(a, b)` ä¸­çš„ `a` ä¸ `b` è‡ªåŠ¨è·å¾— `number` ç±»å‹ï¼Œä¸ç”¨é‡å¤æ ‡æ³¨ã€‚

å‡½æ•°ä½“ä¸­è°ƒç”¨ `wx.cloud.callFunction`ï¼Œä¼ å…¥ `name` ä¸º `sum`ï¼Œè¿™æ˜¯äº‘å‡½æ•°çš„åå­—ã€‚ä¼ å…¥ `data` ä¸º `{ a, b }`ï¼Œè¿™æ˜¯ä¼ ç»™äº‘å‡½æ•°çš„å‚æ•°ï¼Œæœ€ç»ˆä¼šè¢«äº‘å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼ˆé€šå¸¸åä¸º `context`ï¼‰æ¥æ”¶ï¼Œå‚è€ƒä¸Šé¢çš„äº‘å‡½æ•° `sum` ç¼–è¯‘åçš„ä»£ç ï¼š

```js
const default_1 = (a, b) => {
    return a + b;
};
async function main(event) {
    return default_1(event.a, event.b);
}
```

è€Œæœ€åçš„ `.then(res => res.result as any)`ï¼Œåˆ™æ˜¯å¯¹äº‘å‡½æ•°çš„è°ƒç”¨ç»“æœè¿›è¡Œæå–ã€‚è½¬æ¢æˆ `any`ï¼Œç¡®ä¿ç¼–è¯‘å™¨ä¸ä¼šæŠ¥ç±»å‹è½¬æ¢é”™è¯¯ã€‚

### æ€ä¹ˆä½¿ç”¨ï¼Ÿ

```ts
// å¯¼å…¥ï¼Œä½¿ç”¨ç›¸å¯¹è·¯å¾„ï¼Œç›®å‰å®˜æ–¹å°šæœªé»˜è®¤æ”¯æŒ TypeScript åˆ«åï¼š
import { cloudSum } from '../../lib/cloud'

// åœ¨æŸä¸ª async å‡½æ•°å†…ï¼š
const sum = await cloudSum(0.1, 0.2)
console.log({ sum })

// æˆ–è€…åœ¨é async å‡½æ•°å†…ï¼š
cloudSum(0.1, 0.2).then(sum => console.log({ sum }))
```

å°†é¼ æ ‡æ”¾åœ¨ `cloudSum` ä¸Šï¼Œ`vscode` ä¼šç»™ä½ å¼ºç±»å‹çš„æç¤ºï¼š

<img src="assets/03-params-hint.png" alt="cloudSum å‚æ•°æç¤º" width="50%">

å°†é¼ æ ‡æ”¾åœ¨è¿”å›å€¼ `sum` ä¸Šï¼Œ`vscode` ä¹Ÿä¼šç»™ä½ å¼ºç±»å‹çš„æç¤ºï¼š

<img src="assets/04-return-hint.png" alt="cloudSum è¿”å›å€¼æç¤º" width="50%">

ä½ ä»¥ä¸ºåªæœ‰è¿™äº›ï¼Ÿçœ‹åŠ¨ç”»ï¼š

<img src="assets/05-goto.png" width="100%">

### PromiseReturnType åŸç†

> ä¸æƒ³äº†è§£ `TypeScript` é«˜çº§ç”¨æ³•çš„å¯ä»¥è·³è¿‡è¯¥èŠ‚ã€‚

æŸ¥çœ‹ç”Ÿæˆçš„ `miniprogram/lib/cloud.ts`ï¼Œä¼šå‘ç°æœ‰ä¸¤ä¸ª `TypeScript` æ³›å‹ç±»å‹ï¼š

```ts
type PromiseType<T> = T extends Promise<infer _> ? T : Promise<T>

type PromiseReturnType<T extends (...args: any) => any> = (...args: Parameters<T>) => PromiseType<ReturnType<T>>
```

å…ˆçœ‹ `PromiseType<T>`ï¼Œå®ƒç­‰äºï¼š

```ts
T extends Promise<infer _> ? T : Promise<T>
```

`T extends U ? X : Y` è¿™ç§å½¢å¼ï¼Œåœ¨ `TypeScript` ä¸­è¢«ç§°ä¸ºã€Œæ¡ä»¶ç±»å‹ã€ï¼Œæ„æ€æ˜¯ï¼š

> å¦‚æœ T æ‰©å±•è‡ª Uï¼Œé‚£ä¹ˆå–ç±»å‹ Xï¼Œå¦åˆ™å–ç±»å‹ Yã€‚

é‚£ä¹ˆ `T extends Promise<infer _> ? T : Promise<T>` çš„ç»“æœå°±å¥½ç†è§£äº†ï¼Œå¦‚æœ T æ‰©å±•è‡ª Promiseï¼Œé‚£ä¹ˆå°±å– Tï¼ˆæ­¤æ—¶ï¼ŒT æœ¬èº«å°±æ˜¯ Promise çš„ï¼‰ï¼Œå¦åˆ™å°±ç”¨ Promise<T> æŠŠå®ƒåŒ…è£…ä¸€ä¸‹ï¼Œä½¿å…¶æˆä¸º Promiseï¼Œç¡®ä¿å…¶å§‹ç»ˆä¸º Promiseã€‚

è‡³äº `Promise<infer _>` ä¸­çš„ `infer _`ï¼Œ`infer` çš„å«ä¹‰è§ä¸‹é¢ï¼Œ`_` çš„æ„æ€æ˜¯ï¼Œæˆ‘ä¸å…³å¿ƒ `Promise<SomeType>` ä¸­çš„ `SomeType`ï¼Œçœç•¥å°±è¡Œã€‚

> infer ç›¸å½“äºåœ¨ç±»å‹æ¨æ–­ä¸­ï¼Œå®šä¹‰äº†ä¸€ä¸ªä¸´æ—¶å˜é‡ï¼Œç±»ä¼¼äº C# LINQ ä¸­çš„ let è¡¨è¾¾å¼ï¼Œæ›´è¯¦ç»†çš„è®²è§£ï¼Œè¯·å‚è§ï¼šhttps://jkchao.github.io/typescript-book-chinese/tips/infer.htmlã€‚

å†çœ‹ `PromiseReturnType<T>`ï¼Œå…¶å®šä¹‰ä¸ºï¼š

```ts
type PromiseReturnType<T extends (...args: any) => any> = (...args: Parameters<T>) => PromiseType<ReturnType<T>>
```

ä¸€ç‚¹ç‚¹åˆ†æï¼Œç±»å‹å‚æ•° `T extends (...args: any) => any` çš„æ„æ€æ˜¯ï¼šT å¿…é¡»ä¸ºå‡½æ•°ã€‚

`Parameters<T>` æ˜¯ `TypeScript` çš„å†…ç½®åº“ç±»å‹ï¼ŒåŠŸèƒ½ä¸ºï¼šå–å‡½æ•° T çš„å‚æ•°åˆ—è¡¨ã€‚

`ReturnType<T>` ä¹Ÿæ˜¯ `TypeScript` çš„å†…ç½®åº“ç±»å‹ï¼ŒåŠŸèƒ½ä¸ºï¼šå–å‡½æ•° T çš„è¿”å›å€¼ç±»å‹ã€‚

æ•´ä¸ªè¡¨è¾¾å¼ï¼š`(...args: Parameters<T>) => PromiseType<ReturnType<T>>` çš„ä½œç”¨ä¸ºï¼š
> å®šä¹‰ä¸€ä¸ªæ–°å‡½æ•°ï¼Œå–å‡½æ•° T çš„å‚æ•°åˆ—è¡¨ï¼Œä½œä¸ºå®ƒçš„å‚æ•°åˆ—è¡¨ï¼Œå– T çš„è¿”å›å€¼ç±»å‹ï¼Œä½¿ç”¨ `PromiseType` è¿›è¡Œ `Promise` åŒ–ä¸€ä¸‹ï¼Œä½œä¸ºå®ƒçš„è¿”å›å€¼ç±»å‹ã€‚

### æ·±å…¥äº†è§£

å¤§å®¶å¯ä»¥çœ‹ä¸€ä¸‹ä¸¤ä¸ªå†…ç½®åº“ç±»å‹çš„å®ç°ï¼ŒæŒºæœ‰æ„æ€ï¼Œæ³¨æ„çœ‹ `infer` çš„ä½ç½®ï¼š

```ts
/**
 * Obtain the parameters of a function type in a tuple
 */
type Parameters<T extends (...args: any) => any> = T extends (...args: infer P) => any ? P : never;

/**
 * Obtain the return type of a function type
 */
type ReturnType<T extends (...args: any) => any> = T extends (...args: any) => infer R ? R : any;
```

## å¦‚ä½•å®ç°ï¼Ÿ

> ä»æœ¬èŠ‚å¼€å§‹ï¼Œä¸€æ­¥æ­¥ä»‹ç»å¦‚ä½•å®ç°ä¸Šè¿°æ–¹æ¡ˆã€‚

### é€‰æ‹©ç¼–è¯‘ç³»ç»Ÿ

è¦å°† `TypeScript` ç¼–è¯‘æˆ `JavaScript`ï¼Œ`TypeScript` çš„å®˜æ–¹ç¼–è¯‘å™¨ `tsc` å°±å¯ä»¥å®ç°ï¼Œä½†å®ƒä¸å¤Ÿçµæ´»ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰ `rollup`ï¼Œé…åˆ `@rollup/plugin-typescript` æ¥å®Œæˆã€‚

## åŸºæœ¬é…ç½®

